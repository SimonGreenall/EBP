"use strict";!function(t,e){function i(){var t=f.elements;return"string"==typeof t?t.split(" "):t}function n(t){var e=m[t[u]];return e||(e={},p++,t[u]=p,m[p]=e),e}function o(t,i,o){return i||(i=e),d?i.createElement(t):(o||(o=n(i)),i=o.cache[t]?o.cache[t].cloneNode():l.test(t)?(o.cache[t]=o.createElem(t)).cloneNode():o.createElem(t),i.canHaveChildren&&!h.test(t)?o.frag.appendChild(i):i)}function a(t,e){e.cache||(e.cache={},e.createElem=t.createElement,e.createFrag=t.createDocumentFragment,e.frag=e.createFrag()),t.createElement=function(i){return f.shivMethods?o(i,t,e):e.createElem(i)},t.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+i().join().replace(/[\w\-]+/g,function(t){return e.createElem(t),e.frag.createElement(t),'c("'+t+'")'})+");return n}")(f,e.frag)}function s(t){t||(t=e);var i=n(t);if(f.shivCSS&&!r&&!i.hasCSS){var o,s=t;o=s.createElement("p"),s=s.getElementsByTagName("head")[0]||s.documentElement,o.innerHTML="x<style>article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}</style>",o=s.insertBefore(o.lastChild,s.firstChild),i.hasCSS=!!o}return d||a(t,i),t}var r,d,c=t.html5||{},h=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,l=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,u="_html5shiv",p=0,m={};!function(){try{var t=e.createElement("a");t.innerHTML="<xyz></xyz>",r="hidden"in t;var i;if(!(i=1==t.childNodes.length)){e.createElement("a");var n=e.createDocumentFragment();i="undefined"==typeof n.cloneNode||"undefined"==typeof n.createDocumentFragment||"undefined"==typeof n.createElement}d=i}catch(o){d=r=!0}}();var f={elements:c.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:"3.7.0",shivCSS:!1!==c.shivCSS,supportsUnknownElements:d,shivMethods:!1!==c.shivMethods,type:"default",shivDocument:s,createElement:o,createDocumentFragment:function(t,o){if(t||(t=e),d)return t.createDocumentFragment();for(var o=o||n(t),a=o.frag.cloneNode(),s=0,r=i(),c=r.length;c>s;s++)a.createElement(r[s]);return a}};t.html5=f,s(e)}(this,document),seajs.config({base:"//user.vipstatic.com",alias:{dropdown:"js/ui/dropdown",post:"js/lib/post",panel:"js/lib/panel",address:"js/address",integral:"js/integral",coupons:"js/coupons",vipmoney:"js/vipmoney",userIcon:"js/userIcon",underscore:"js/lib/underscore/underscore-min",DateList:"js/lib/DateList",Utility:"js/lib/Utility",AjaxHandler:"js/lib/AjaxHandler",smartdropdown:"js/ui/smartdropdown",paysecurity:"js/validation/paysecurity",md5:"js/validation/md5",pwdCrypto:"js/validation/pwdCrypto",vipSubString:"js/lib/vipSubString",StringExtend:"js/StringExtend",core3:"js/lib/core3",tip:"js/lib/tip-component"},map:[[".js",".js?v=2015091602"]],debug:2,charset:"utf-8"}),"object"!=typeof JSON&&(JSON={}),function(){function f(t){return 10>t?"0"+t:t}function quote(t){return escapable.lastIndex=0,escapable.test(t)?'"'+t.replace(escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var i,n,o,a,s,r=gap,d=e[t];switch(d&&"object"==typeof d&&"function"==typeof d.toJSON&&(d=d.toJSON(t)),"function"==typeof rep&&(d=rep.call(e,t,d)),typeof d){case"string":return quote(d);case"number":return isFinite(d)?String(d):"null";case"boolean":case"null":return String(d);case"object":if(!d)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(d)){for(a=d.length,i=0;a>i;i+=1)s[i]=str(i,d)||"null";return o=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+r+"]":"["+s.join(",")+"]",gap=r,o}if(rep&&"object"==typeof rep)for(a=rep.length,i=0;a>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],o=str(n,d),o&&s.push(quote(n)+(gap?": ":":")+o));else for(n in d)Object.prototype.hasOwnProperty.call(d,n)&&(o=str(n,d),o&&s.push(quote(n)+(gap?": ":":")+o));return o=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+r+"}":"{"+s.join(",")+"}",gap=r,o}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx,escapable,gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,JSON.parse=function(text,reviver){function walk(t,e){var i,n,o=t[e];if(o&&"object"==typeof o)for(i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n=walk(o,i),void 0!==n?o[i]=n:delete o[i]);return reviver.call(t,e,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),seajs.use(["post","DateList","Utility","AjaxHandler","js/ui/dialog","underscore","userIcon","smartdropdown"],function(t,e,i,n,o){var a=(t.post,new e.DateList),i=i.Utility,n=n.AjaxHandler,s=/msie/i.test(navigator.userAgent),r=90,d={tooltipsWarning:"ui-tooltips.warning",tooltipsInfo:"ui-tooltips.info",inputError:"input-error"},c={pureNumberic:/[0-9]+/,illegalNickName:/([^A-Za-z0-9\u4e00-\u9fa5])+/,areaCode:/^[0][0-9]{2,3}$/,withoutAreaCodePhone:/^[0-9]{5,10}$/,withAreaCodePhone:/^[0-9]{5,10}$/,email:/^\w+[-\.\w]*@[A-Za-z0-9]+(\.)[\.\w\-]+$/,mobile:/^[1-9]{1}[0-9]+$/};window.myitoken="";var h=function(){this.$tabs=$(".account > .accountTabs > .tab"),this.$tabContents=$(".account > .accountContent > .tab-content"),this.$accountBasicinfo=$(".accountBasicinfo");var t=this.$accountBasicinfo;this.$resetBtn=t.find(".reset-info"),this.$submitInfoBtn=t.find("#submitInfoBtn"),this.$contentLoading=t.find(".contentLoading"),this.$contentWarning=t.find(".contentWarning"),this.$itemsContent=t.find(".itemsContent"),this.$mobileRow=t.find("#mobileRow"),this.$successNotice=$("#success-notice"),this.$birthdayText=$("#basicBirthdayText"),this.$activeTabName=$("#activeTabName"),this.$birthdauUpdate=$("#birthdauUpdate"),this.userHead={avatar:t.find(".hd-avatar"),userName:t.find(".userName"),integrity:t.find(".u-profile > i"),ratePerfect:t.find("#ratePerfect")},this.controls={nickname:t.find('input[name="nickname"]'),gender:t.find('input[name="gender"]'),birthday:t.find('input[name="birthday"]'),mobile:t.find('input[name="mobile"]'),areaCode:t.find('input[name="areaCode"]'),telephone:t.find('input[name="telephone"]'),provinceId:t.find('input[name="provinceId"]'),cityId:t.find('input[name="cityId"]'),countryId:t.find('input[name="countryId"]'),address:t.find('input[name="address"]'),email:t.find('input[name="email"]')},this.mockRadio={radioGender:t.find(".radio-gender"),maleGender:t.find("#maleGender"),femaleGender:t.find("#femaleGender")},this.mockDropDown={year:t.find("#dlYear"),month:t.find("#dlMonth"),day:t.find("#dlDay"),province:t.find("#dlProvince"),city:t.find("#dlCity"),district:t.find("#dlDistrict"),country:t.find("#dlCountry")},this.$areaDropDowns=t.find(".address-item .ui-dropdown"),this.$birthdayYear=this.mockDropDown.year.find('input[type="hidden"]'),this.$birthdayMonth=this.mockDropDown.month.find('input[type="hidden"]'),this.$birthdayDay=this.mockDropDown.day.find('input[type="hidden"]'),this.errors={},this.addressAreaData=[],this.fullNameData=null,this.isDirectly="0",this.oldIsDirectly="0",this.areaNames=[],this.firstLoad=!0,this.submitted=!1};h.prototype={getBasicInfoData:function(t){var e=this;$.getJSON("//myi.vip.com/api/account/base_info",function(i){n.handle302(i),200==i.code?(e.oldBasicInfoData=i.data,t&&t(i)):e.loadFailedBasicContent()}).fail(function(){e.loadFailedBasicContent()})},parseBirthday:function(t){var e=t.split("-");return{year:e[0],month:e[1],day:e[2]}},getAreaData:function(t,e){"undefined"!=typeof t&&$.ajax({url:"//gensvr-n.vip.com/address/address?areaid="+(t?t:""),dataType:"jsonp",beforeSend:e.beforeSend,success:e.success,error:e.error,complete:e.complete})},displayAvatarInfo:function(){var t=this;$.getJSON("//myi.vip.com/api/account/extra_info",function(e){var i=e.data;n.handle302(e),i&&(i.image_url&&t.userHead.avatar.find(" > img").attr("src",i.image_url),2==i.check_status&&$(".J_avatar_fali_tip").addClass("z-ui-tooltips-in"),t.displayIntegrityRate(i.profile_integrity))})},displayBasicInfo:function(){var t=this;this.getBasicInfoData(function(e){var i=e.data;(null==i||void 0===i)&&(i={}),i.registerByMobile=t.isRegisterByMobile(i.userName),t.bindBasicInfoData(i)})},isRegisterByMobile:function(t){return c.mobile.test(t)?!0:!1},bindBasicInfoData:function(t){var e=this,i=null;this.userHead.userName.text(t.userName),this.mockRadio.radioGender.removeClass("active"),void 0!==t.gender&&null!=t.gender&&""!==t.gender&&this.mockRadio.radioGender.filter('[data-value="'+t.gender+'"]').addClass("active"),void 0!==t.birthday&&null!=t.birthday&&""!==t.birthday&&(i=this.parseBirthday(t.birthday)),this.resetBirthdayDropDown(i,t.isAllowUpdateBirthday),_.each(t,function(i,n){e.controls[n]&&("nickname"!==n||null!=i&&""!==i?"bindEmail"==n||"email"==n?t.bindEmail&&""==t.bindEmail||void 0==t.bindEmail?($(".J_email_box").addClass("hidden"),$(".J_email_input_box").removeClass("hidden"),e.controls.email.val("")):($(".J_email_box").addClass("hidden"),$(".J_email_txt_box").removeClass("hidden"),$(".J_email_txt").html(t.bindEmail)):e.controls[n].val(i):e.controls[n].val("唯品会会员"))}),e.handleMobileState(t),this.addressAreaData.length>0?this.renderAreaDropDownFromCache(this.addressAreaData):this.bindAddressArea(t)},handleMobileState:function(t){var e=this;$.getJSON("//myi.vip.com/jsonp/api/phone/phone_safe_number",function(i){var n=i.data;n?(e.$mobileRow.find(".mobile-number").text(n).removeClass("hidden"),e.$mobileRow.find(".mobile-verified").removeClass("hidden"),e.controls.mobile.val(n)):t.isRegisterByMobile?(e.$mobileRow.find(".mobile-number").text(n).removeClass("hidden"),e.$mobileRow.find(".button").removeClass("hidden"),e.controls.mobile.val(n)):(e.$mobileRow.find(".ui-input").removeClass("hidden"),e.$mobileRow.find(".button").removeClass("hidden"))})},arrayUniquel:function(t){for(var e=[],i=t.length,n=0;i>n;n++)-1==$.inArray(t[n],e)&&e.push(t[n]);return e},bindAddressArea:function(t){var e,i,n=this,o=function(t){$.get("//gensvr-n.vip.com/address/address?areaid="+t,function(t){var e=t.info,i=e.name,o=e.full_name;n.fullNameData=e.full_name,i.indexOf("我不清楚")>-1&&(o=o.replace(".我不清楚",""),o+="."+i),n.areaNames=n.arrayUniquel(o.split(".")),n.showBasicContent(),n.areaNames&&n.areaNames.length>0&&$.get("//gensvr-n.vip.com/address/address?areaid=",function(t){n.addAreaDropDownOptions(t.list,n.mockDropDown.province),n.mockDropDown.province.smartdropdown("selected",n.areaNames[0])},"jsonp").fail(function(){n.loadFailedBasicContent()})},"jsonp").fail(function(){n.loadFailedBasicContent()})};t.countryId&&parseInt(t.countryId)>0?o(t.countryId):(e=t.provinceId,(void 0===t.provinceId||null==t)&&(e="0"),i=this.mockDropDown.province.add(this.mockDropDown.city).add(this.mockDropDown.district).add(this.mockDropDown.country),i.removeClass("hidden"),this.resetMockDropDown(i),$.get("//gensvr-n.vip.com/address/address?areaid=",function(t){n.addAreaDropDownOptions(t.list,n.mockDropDown.province),n.mockDropDown.province.find(".text").text("省/直辖市"),parseInt(e)>0&&n.mockDropDown.province.smartdropdown("selected",e),n.firstLoad=!1,n.showBasicContent()},"jsonp"))},renderAreaDropDownFromCache:function(t){var e,i,n=t.length;e=this.$areaDropDowns.slice(0,n),this.$areaDropDowns.slice(n).addClass("hidden"),this.resetMockDropDown(this.$areaDropDowns);for(var o=0;n>o;o++)i=e.eq(o),this.addAreaDropDownOptions(t[o].data,i),i.smartdropdown("selected",t[o].id,!0),i.find(".text").removeClass("c_999"),i.removeClass("hidden")},getDataFromAreaOptions:function(){function t(t){var e,i=[],n=t.find(".options > .item");return n.each(function(){e=$(this),i.push({id:e.attr("data-value"),name:e.attr("data-text")})}),i}var e,i,n=[];e=this.$areaDropDowns.not(".hidden"),i=e.length;for(var o=0;i>o;o++)n.push({id:e.eq(o).smartdropdown("getValue"),data:t(e.eq(o))});return n},showBasicContent:function(){this.$contentLoading.hide(),this.$contentWarning.hide(),this.$itemsContent.show()},loadFailedBasicContent:function(){this.$contentLoading.hide(),this.$contentWarning.show(),this.$itemsContent.hide()},displayIntegrityRate:function(t){var e=t/100*r,i=20>e?20:e;this.userHead.integrity.css("width",i+"px").text(t+"%"),this.userHead.integrity.removeClass("bc_ee0000 bc_f09513 bc_f19413 bc_3bad00"),this.userHead.integrity.addClass(5>=t?"bc_ee0000":50>=t?"bc_f09513":100>t?"bc_f19413":"bc_3bad00"),100===t?this.userHead.ratePerfect.show():this.userHead.ratePerfect.hide()},resetBirthdayDropDown:function(t,e){var i,n=this.generateOptions(a.dateRange.yearStart,a.dateRange.yearEnd,!0),o=this.generateOptions(a.dateRange.monthStart,a.dateRange.monthEnd),s=this.generateOptions(a.dateRange.dayStart,a.dateRange.dayEnd);this.resetMockDropDown(this.mockDropDown.year),this.resetMockDropDown(this.mockDropDown.month),this.resetMockDropDown(this.mockDropDown.day),this.mockDropDown.year.smartdropdown("append",n),this.mockDropDown.month.smartdropdown("append",o),this.mockDropDown.day.smartdropdown("append",s),e&&this.$birthdauUpdate.removeClass("hidden"),t?(this.mockDropDown.year.smartdropdown("selected",t.year),this.mockDropDown.month.smartdropdown("selected",parseInt(t.month)),this.mockDropDown.day.smartdropdown("selected",parseInt(t.day)),this.mockDropDown.year.addClass("hidden"),this.mockDropDown.month.addClass("hidden"),this.mockDropDown.day.addClass("hidden"),this.mockDropDown.year.siblings(".toLeft").addClass("hidden"),i=t.year+"-"+parseInt(t.month)+"-"+parseInt(t.day),this.$birthdayText.text(i).removeClass("hidden")):(this.mockDropDown.year.removeClass("hidden"),this.mockDropDown.month.removeClass("hidden"),this.mockDropDown.day.removeClass("hidden"),this.mockDropDown.year.find('input[type="hidden"]').val(""),this.mockDropDown.year.find(".text").text("请选择").addClass("c_999"),this.mockDropDown.month.find('input[type="hidden"]').val(""),this.mockDropDown.month.find(".text").text("请选择").addClass("c_999"),this.mockDropDown.day.find('input[type="hidden"]').val(""),this.mockDropDown.day.find(".text").text("请选择").addClass("c_999"))},showBirthdaySelecter:function(){$().add(this.$birthdayText).add(this.$birthdauUpdate).addClass("hidden"),$().add(this.mockDropDown.year).add(this.mockDropDown.month).add(this.mockDropDown.day).removeClass("hidden")},resetMockDropDown:function(t){t.each(function(){var t=$(this);t.smartdropdown("reset");var e=t.attr("data-placeholder");e&&""!==e&&t.find(" > .text").text(e),t.removeClass(d.inputError),t.find(".text").addClass("c_999")})},reCalcDayDropDown:function(t,e){var i,n,o=parseInt(e),s=parseInt(t),r=parseInt(this.mockDropDown.day.smartdropdown("getValue"));a.fixDayRange(s,o),n=this.generateOptions(a.dateRange.dayStart,a.dateRange.dayEnd),this.mockDropDown.day.smartdropdown("render",n),r>a.dateRange.dayEnd?(i="",this.mockDropDown.day.smartdropdown("selected",i),this.mockDropDown.day.find(".text").text("请选择")):(i=r,this.mockDropDown.day.smartdropdown("selected",i))},generateOptions:function(t,e,i){var n=[];if(i)for(var o=e;o>=t;o--)n.push({text:o,value:o});else for(var o=t;e>=o;o++)n.push({text:o,value:o});return n},initAreaDropDown:function(t,e,i,n){var o=this;this.getAreaData(t,{beforeSend:function(){e.find(".options").html('<div class="s-loading small"><span>请稍后</span></div>')},success:function(a){var s=e.nextAll(".ui-dropdown");if(t&&"dlCity"===e.attr("id")&&(s.removeClass("hidden"),a.info&&"1"===a.info.is_directly?(o.isDirectly="1",o.oldIsDirectly="1",o.mockDropDown.country.addClass("hidden")):(o.isDirectly="0",o.oldIsDirectly="0")),e.length>0)switch(a.list.length){case 0:e.addClass("hidden"),e.smartdropdown("hide");break;case 1:"0"===a.list[0].id?(e.addClass("hidden"),e.smartdropdown("hide")):o.fillAreaData(e,a,i);break;default:o.fillAreaData(e,a,i)}n&&n(a)},error:function(){o.resetMockDropDown(e)},complete:function(){e.find(".options .s-loading").remove()}})},setAreaDropPlaceholder:function(t){t||("1"===this.isDirectly?(this.mockDropDown.city.find(".text").text("区/县"),this.mockDropDown.district.find(".text").text("乡镇/街道")):(this.mockDropDown.city.find(".text").text("市"),this.mockDropDown.district.find(".text").text("区/县")))},fillAreaData:function(t,e,i){t.removeClass("hidden"),e.list&&this.addAreaDropDownOptions(e.list,t),i?(t.smartdropdown("selected",i),t.find(".text").removeClass("c_999")):t.find(".text").addClass("c_999")},handleAreaCompleted:function(){this.firstLoad&&(this.areaNames=[],this.addressAreaData=this.getDataFromAreaOptions(),this.showBasicContent(),this.firstLoad=!1)},addAreaDropDownOptions:function(t,e){var i,n,o,a,s;i=_.filter(t,function(t){return parseInt(t.id)>0&&"我不清楚"!==t.name}),n=_.find(t,function(t){return"我不清楚"===t.name}),n&&i.push(n),o=_.map(i,function(t){return{text:t.name,value:t.id}}),s=o.length,e.smartdropdown("render",o),a=e.find(".item"),n&&e.find(".options > span").eq(0).before('<p class="highlight">*如不清楚，可选择“我不清楚”。</p>')},setDropDownPlaceHolder:function(t,e){var i;i=e===!0?"data-changed-placeholder":"data-placeholder";var n=t.attr(i);n&&""!==n&&t.find("> .text").text(n)},addErrorMark:function(t,e){var i=t.attr("name");t.addClass(d.inputError),t.siblings("."+d.tooltipsInfo).hide(),this.errors[i]=e},removeErrorMark:function(t){var e=t.attr("name");this.errors[e]="",t.removeClass(d.inputError)},showError:function(t,e){this.addErrorMark(t,e),t.siblings("."+d.tooltipsWarning).find("span").html(e).end().show()},removeError:function(t){this.removeErrorMark(t),t.siblings("."+d.tooltipsWarning).find("span").html("").end().hide()},activeGender:function(t){var e=$(t.target),i=e.attr("data-value");this.mockRadio.radioGender.removeClass("active"),this.mockRadio.radioGender.filter(e).addClass("active"),this.controls.gender.val(i)},showNickNameTips:function(){var t=this.controls.nickname;this.hideErrorTips(t),t.siblings("."+d.tooltipsInfo).show()},showErrorTips:function(t,e){t.siblings("."+d.tooltipsWarning).find("span").html(e).end().show()},hideErrorTips:function(t){t.removeClass(d.inputError).siblings("."+d.tooltipsWarning).hide()},hideInfoTips:function(t){t.siblings("."+d.tooltipsInfo).hide()},showInfoTips:function(t){t.siblings("."+d.tooltipsInfo).show()},validateNickName:function(){var t,e,n=0,o=0,a=this.controls.nickname,s=$.trim(a.val());if(a.siblings("."+d.tooltipsInfo).hide(),""===s)return this.showError(a,"请输入昵称"),!1;t=s.split(""),e=t.length;for(var r=0;e>r;r++)c.pureNumberic.test(t[r])&&n++;return e===n?(this.showError(a,"不能设置纯数字，请更换~！~"),!1):(o=e+i.checkChineseLength(s),4>o||o>20?(this.showError(a,"昵称格式不正确"),!1):c.illegalNickName.test(s)?(this.showError(a,"昵称格式不正确"),!1):(this.removeError(a),!0))},validateBrithday:function(){if(this.mockDropDown.year.hasClass("hidden"))return this.removeError(this.mockDropDown.day),!0;var t,e,i,n,o,a,s,r=this.$birthdayYear.val(),d=this.$birthdayMonth.val(),c=this.$birthdayDay.val();return n=new Date,o=n.getFullYear(),a=n.getMonth()+1,s=n.getDate(),t=""===r?0:parseInt(r),e=""===d?0:parseInt(d),i=""===c?0:parseInt(c),""===r?(this.showError(this.mockDropDown.year,"请填写您的年份"),!1):(this.removeError(this.mockDropDown.year),""===d?(this.showError(this.mockDropDown.month,"请填写您的月份"),!1):(this.removeError(this.mockDropDown.month),""===c?(this.showError(this.mockDropDown.day,"请填写您的生日"),!1):(this.removeError(this.mockDropDown.day),t>o||t===o&&e>a||t===o&&e===a&&i>s?(this.showError(this.mockDropDown.day,"生日日期大于当前日期"),!1):(this.removeError(this.mockDropDown.day),!0))))},showPhoneNumberTips:function(){$.trim(this.controls.areaCode.val()),$.trim(this.controls.telephone.val());this.controls.areaCode.add(this.controls.telephone).removeClass(d.inputError).siblings("."+d.tooltipsWarning).hide(),this.controls.telephone.siblings("."+d.tooltipsInfo).show()},validateAreaCode:function(){var t=!0,e="请输入正确的电话号码",i=$.trim(this.controls.areaCode.val());return this.hideInfoTips(this.controls.areaCode),""===i?this.removeErrorMark(this.controls.areaCode):c.areaCode.test(i)?this.removeErrorMark(this.controls.areaCode):(this.addErrorMark(this.controls.areaCode,e),t=!1),t||this.showErrorTips(this.controls.areaCode,e),t},validateTelephone:function(){var t=!0,e="请输入正确的电话号码",i=$.trim(this.controls.areaCode.val()),n=$.trim(this.controls.telephone.val());return this.hideInfoTips(this.controls.telephone),""===i?""===n?this.removeErrorMark(this.controls.telephone):c.withoutAreaCodePhone.test(n)?this.removeErrorMark(this.controls.telephone):(this.addErrorMark(this.controls.telephone,e),t=!1):(c.areaCode.test(i)?this.removeErrorMark(this.controls.areaCode):(this.addErrorMark(this.controls.areaCode,e),t=!1),c.withAreaCodePhone.test(n)?this.removeErrorMark(this.controls.telephone):(this.addErrorMark(this.controls.telephone,e),t=!1)),t||this.showErrorTips(this.controls.telephone,e),t},showAddressTips:function(){var t=this.controls.address.val();this.hideErrorTips(this.controls.address),""===t?this.showInfoTips(this.controls.address):this.hideInfoTips(this.controls.address)},validateAddress:function(){var t,e,i=$.trim(this.controls.address.val()),n=this.$areaDropDowns.not(".hidden"),o=n.last().smartdropdown("getValue");return this.hideInfoTips(this.controls.address),n.each(function(){t=$(this),e=t.smartdropdown("getValue"),""===e?t.addClass(d.inputError):t.removeClass(d.inputError)}),""===o||""===i?(this.showError(this.controls.address,"请填写完整的地址信息"),this.calcTooltipsPosition(this.controls.address),!1):i.length>30?(this.showError(this.controls.address,"最大长度为30个字符"),this.calcTooltipsPosition(this.controls.address),!1):(this.removeError(this.controls.address),!0)},calcTooltipsPosition:function(t){var e=t[0].offsetLeft,i=t.siblings(".warning"),n=t.outerWidth(!0);i.hide(),i.css({position:"absolute",left:e+n}).show()},validateEmail:function(){var t=$.trim(this.controls.email.val());return this.hideInfoTips(this.controls.email),t.length>50?(this.showError(this.controls.email,"邮箱最大长度为50个字符"),!1):c.email.test(t)?(this.removeError(this.controls.email),!0):(this.showError(this.controls.email,"请输入正确的邮箱账号"),!1)},validateGender:function(){var t=$("#J_gender_options");return 0==t.attr("value")||1==t.attr("value")?(this.removeError(this.controls.gender),!0):(this.showError(this.controls.gender,"请选择您的性别"),!1)},submitBaiscInfo:function(t){if(t.preventDefault(),!myitoken)return this.showDialog("warning","请求提交失败，请稍后再试。"),!1;if(!this.$submitInfoBtn.hasClass("disabled")){var e,i,o,a,s,r,d,c=this,h=[],l=[];l.push(this.validateNickName()),l.push(this.validateGender()),l.push(this.validateBrithday()),l.push(this.validateTelephone()),l.push(this.validateAddress());var u=_.contains(l,!1);u||(this.$submitInfoBtn.addClass("disabled"),this.mockDropDown.year.hasClass("hidden")||(s=this.$birthdayYear.val(),r=this.$birthdayMonth.val(),d=this.$birthdayDay.val(),""!==r&&1===r.length&&(r="0"+r),""!==d&&1===d.length&&(d="0"+d),this.controls.birthday.val(s+"-"+r+"-"+d)),e=this.$areaDropDowns.filter(":not(.hidden)"),i=e.length,a=e.eq(i-1).smartdropdown("getValue"),o=i>2?e.eq(i-2).smartdropdown("getValue"):a.substring(0,9),12===o.length&&(o=o.substring(0,9)),this.controls.cityId.val(o),this.controls.countryId.val(a),h=_.map(this.controls,function(t,e){return{name:e,value:$.trim(t.val())}}),h.push({name:"myitoken",value:myitoken}),$.post("//myi.vip.com/api/account/base_info",h,function(t){n.handle302(t);var e,i,o;200===t.code?(c.submitted=!0,c.mockDropDown.year.hasClass("hidden")||(c.mockDropDown.year.addClass("hidden"),e=c.$birthdayYear.val()),c.mockDropDown.month.hasClass("hidden")||(c.mockDropDown.month.addClass("hidden"),i=c.$birthdayMonth.val()),c.mockDropDown.day.hasClass("hidden")||(c.mockDropDown.day.addClass("hidden"),o=c.$birthdayDay.val(),c.mockDropDown.year.siblings(".toLeft").addClass("hidden"),c.$birthdayText.text(e+"-"+parseInt(i)+"-"+parseInt(o)).removeClass("hidden")),c.resetBasicInfoData(),c.addressAreaData=c.getDataFromAreaOptions(),c.oldIsDirectly=c.isDirectly,c.displayAvatarInfo(),c.showDialog("success","资料保存成功",function(){"1"===t.msg&&c.showVMarkNotice()})):600==t.code?(c.showDialog("warning","昵称含有非法词汇，请重新输入"),c.controls.nickname.addClass("input-error")):c.showDialog("warning","资料保存失败")},"json").fail(function(){c.showDialog("warning","资料保存失败")}).always(function(){c.$submitInfoBtn.removeClass("disabled")}))}},showDialog:function(t,e,i){o.show({title:"",type:t,msg:e,mask:!0,exClassName:"basic-info-dialog",width:380,buttons:[{text:"确定",type:"primary",click:function(){this.remove(),i&&i()}}]})},showVMarkNotice:function(){var t=this;this.$successNotice.height(0).removeClass("hidden"),this.$successNotice.animate({marginTop:10,height:30,opacity:1},500),setTimeout(function(){t.$successNotice.animate({marginTop:0,height:0,opacity:0},500,function(){t.$successNotice.addClass("hidden")})},6e3)},resetBasicInfoData:function(){var t=this;_.each(this.controls,function(e,i){t.oldBasicInfoData[i]=e.val()})},reset:function(){this.submitted=!1,this.isDirectly=this.oldIsDirectly,this.bindBasicInfoData(this.oldBasicInfoData),this.$accountBasicinfo.find(":text").removeClass(d.inputError),this.$accountBasicinfo.find(".ui-tooltips").hide(),$.each(this.mockDropDown,function(){$(this).removeClass(d.inputError)})},fixPlaceholderText:function(t,e){var i=t.text();i.length>e?t.text(i.substring(0,e)).attr("title",i):t.removeAttr("title")},initMockAddressDropDown:function(){var t=this;this.mockDropDown.province.smartdropdown({itemTagName:"span",maxCount:30,onChange:function(e,i){var n=$(this),o=n.find(".text"),a=n.nextAll(".ui-dropdown");""!==e&&(n.removeClass(d.inputError),o.removeClass("c_999")),t.fixPlaceholderText(o,8),t.resetMockDropDown(a),t.firstLoad||t.mockDropDown.city.smartdropdown("show"),t.initAreaDropDown(e,t.mockDropDown.city,t.areaNames[1],function(){s&&(o.text(o.text()),t.fixPlaceholderText(o,8)),t.firstLoad||t.setAreaDropPlaceholder(t.areaNames[1])})}}),this.mockDropDown.city.smartdropdown({itemTagName:"span",maxCount:30,onChange:function(e,i){var n=$(this),o=n.find(".text"),a=n.nextAll(".ui-dropdown");""!==e&&(n.removeClass(d.inputError),o.removeClass("c_999")),t.fixPlaceholderText(o,8),t.resetMockDropDown(a),t.firstLoad||t.mockDropDown.district.smartdropdown("show"),t.initAreaDropDown(e,t.mockDropDown.district,t.areaNames[2],function(){t.firstLoad?2===t.areaNames.length&&t.handleAreaCompleted():(t.mockDropDown.district.find(".text").text("1"===t.isDirectly&&void 0===t.areaNames[2]?"乡镇/街道":"区/县"),t.validateAreaDropDown(t.mockDropDown.city))})}}),this.mockDropDown.district.smartdropdown({itemTagName:"span",maxCount:30,onChange:function(e,i){var n=$(this),o=n.find(".text"),a=n.nextAll(".ui-dropdown");""!==e&&(n.removeClass(d.inputError),o.removeClass("c_999")),t.fixPlaceholderText(o,8),t.resetMockDropDown(a),t.firstLoad||"0"!==t.isDirectly||t.mockDropDown.country.smartdropdown("show"),t.initAreaDropDown(e,t.mockDropDown.country,t.areaNames[3],function(){t.firstLoad?t.handleAreaCompleted():t.validateAreaDropDown(t.mockDropDown.district)})}}),this.mockDropDown.country.smartdropdown({itemTagName:"span",maxCount:30,onChange:function(e,i){var n=$(this),o=n.find(".text"),a=n.next(".ui-dropdown");""!==e&&(n.removeClass(d.inputError),o.removeClass("c_999")),t.fixPlaceholderText(o,8),t.firstLoad||t.initAreaDropDown(e,a,null,function(){t.firstLoad||t.validateAreaDropDown(t.mockDropDown.country)})}})},validateAreaDropDown:function(t){var e=$.trim(this.controls.address.val()),i=this.$areaDropDowns.not(":hidden");""!==e&&i.last().is(t)&&this.validateAddress()},switchTabs:function(t){var e=$(t.target),i=this.$tabs.index(e);this.$tabs.removeClass("active"),e.addClass("active"),this.$activeTabName.text(e.text()),this.$tabContents.removeClass("active"),this.$tabContents.eq(i).addClass("active")},initBirthdayDropDown:function(){var t=this;this.mockDropDown.year.smartdropdown({onChange:function(e,i){var n=$(this).find(".text"),o=t.mockDropDown.month.smartdropdown("getValue");""!==e&&n.removeClass("c_999"),t.reCalcDayDropDown(e,o),t.validateBrithday()}}),this.mockDropDown.month.smartdropdown({onChange:function(e,i){var n=$(this).find(".text"),o=t.mockDropDown.year.smartdropdown("getValue");""!==e&&n.removeClass("c_999"),t.reCalcDayDropDown(o,e),t.validateBrithday()}}),this.mockDropDown.day.smartdropdown({onChange:function(e,i){var n=$(this).find(".text");""!==e&&n.removeClass("c_999"),t.validateBrithday()}})},checkThirdPartyLogin:function(){$.get("//myi.vip.com/api/account/checkThirdLoginOnly",function(t){t&&"200"==t.code&&t.data?$(".J_login_setting").removeClass("hidden"):$(".J_login_setting").addClass("hidden")})},get_verify_token:function(){var t="//myi.vip.com/api/common/get_verify_token";$.get(t,function(t){200==t.code&&(myitoken=t.myitoken||"")})},init:function(){var t=this;this.get_verify_token(),this.initBirthdayDropDown(),this.initMockAddressDropDown(),this.displayAvatarInfo(),this.displayBasicInfo(),this.checkThirdPartyLogin(),this.$resetBtn.on("click",_.bind(this.reset,this)),this.mockRadio.radioGender.on("click",_.bind(this.activeGender,this)),this.mockRadio.radioGender.on("click",_.bind(this.validateGender,this)),this.controls.nickname.on("focus",_.bind(this.showNickNameTips,this)),this.controls.nickname.on("blur",_.bind(this.validateNickName,this)),this.controls.areaCode.add(this.controls.telephone).on("focus",_.bind(this.showPhoneNumberTips,this)),this.controls.areaCode.on("blur",_.bind(this.validateAreaCode,t)),this.controls.telephone.on("blur",_.bind(this.validateTelephone,t)),this.controls.address.on("focus",_.bind(this.showAddressTips,this)),this.controls.address.on("blur",_.bind(this.validateAddress,this)),this.controls.email.on("blur",_.bind(this.validateEmail,this)),this.controls.email.on("focus",function(){t.hideErrorTips(t.controls.email)}),this.$submitInfoBtn.on("click",_.bind(this.submitBaiscInfo,this)),this.$tabs.on("click",_.bind(this.switchTabs,this)),this.$birthdauUpdate.find("a").on("click",_.bind(this.showBirthdaySelecter,this))}},h.prototype.constructor=h,$(function(){(new h).init()})}),seajs.use(["post","AjaxHandler","js/ui/dialog","Utility","smartdropdown","underscore"],function(t,e,i,n){var n=(t.post,n.Utility),e=e.AjaxHandler,o=function(){this.$surveyForm=$("#userSurveyForm"),this.$surveySubmit=this.$surveyForm.find(".survey-submit"),this.$surveyReset=this.$surveyForm.find(".survy-reset"),this.$dropdowns=this.$surveyForm.find(".ui-dropdown"),this.$chooseGroup=this.$surveyForm.find(".choose-group").not(".marry-status"),this.$marryRadio=this.$surveyForm.find(".marry-radio"),this.$childRadio=this.$surveyForm.find(".child-radio"),this.$childStatus=this.$surveyForm.find(".child-status"),this.$inputs=this.$surveyForm.find(':text, input[type="hidden"]'),this.$others=this.$surveyForm.find(".input-other"),this.oldSurveyData={},this.$successNotice=$("#success-notice")};o.prototype={init:function(){
this.$dropdowns.smartdropdown({setItemTitle:!1}),this.getData(),this.$chooseGroup.on("click","li[data-value]",$.proxy(this.toggleItem,this)),this.$marryRadio.on("click",$.proxy(this.toggleMarryStatus,this)),this.$childRadio.on("click",$.proxy(this.toggleChildStatus,this)),this.$surveySubmit.on("click",$.proxy(this.submit,this)),this.$surveyReset.on("click",$.proxy(this.reset,this)),this.$others.on("blur",$.proxy(this.validateOther,this)),this.$others.on("focus",$.proxy(this.othersFocus,this))},getData:function(){var t=this;$.get("//myi.vip.com/api/account/survey",function(i){e.handle302(i);var n=i.data;n?(t.bindSurveyJson(n),t.renderMockFormElement(),t.bindInputsToOldSurveyData(),n.is_married&&1===n.is_married?t.$childStatus.removeClass("hidden"):t.$childStatus.addClass("hidden")):(t.$dropdowns.find("> .text").text("请选择"),t.$childStatus.addClass("hidden"))},"json")},bindSurveyJson:function(t){var e,i,n=this;_.each(t,function(t,o){e=n.$surveyForm.find('input[name="'+o+'"]'),"object"==typeof t&&void 0!==t.id?e.val(t.id):_.isArray(t)?(i=t.join(","),e.val(i)):e.val(t)})},bindInputsToOldSurveyData:function(){var t=this;this.$inputs.each(function(){t.oldSurveyData[this.name]=this.value})},bindOldSurveyDataToInputs:function(){var t,e=this;_.each(this.oldSurveyData,function(i,n){t=e.$inputs.filter('[name="'+n+'"]'),t.length>0&&t.val(i)})},renderMockFormElement:function(){this.$inputs.each(function(){var t,e,i,n,o,a,s,r=$(this);switch(t=r.attr("data-type"),e=r.attr("name"),i=r.val(),n=r.parent(),t){case"radio":o=n.find('[data-name="'+e+'"]'),o.removeClass("active"),o.filter('[data-value="'+i+'"]').addClass("active");break;case"radio-list":o=n.find("li"),o.removeClass("active"),o.filter('[data-value="'+i+'"]').addClass("active");break;case"dropdown":n.smartdropdown("selected",i,!1),0===i&&n.find("> .text").text("请选择");break;case"checkbox":if(o=n.find("li[data-value]"),o.removeClass("active"),i){a=i.split(","),s=a.length;for(var d=0;s>d;d++)o.filter('[data-value="'+a[d]+'"]').addClass("active")}}})},toggleItem:function(t){var e,i=$(t.target),n=i.parent(),o=i.parents(".choose-group"),a=o.attr("data-name"),s=[];n.hasClass("radio-list")?(n.find("li").removeClass("active"),i.addClass("active"),o.find('input[name="'+a+'"]').val(i.attr("data-value"))):(i.toggleClass("active"),e=n.find(".active"),e.each(function(){var t=$(this).attr("data-value");s.push(t)}),o.find('input[name="'+a+'"]').val(s.join(",")))},toggleMarryStatus:function(t){var e=$(t.target);"1"===e.attr("data-value")?this.$childStatus.removeClass("hidden"):this.$childStatus.addClass("hidden"),this.$marryRadio.removeClass("active"),e.addClass("active"),this.$surveyForm.find('input[name="is_married"]').val(e.attr("data-value"))},toggleChildStatus:function(t){var e=$(t.target);this.$childRadio.removeClass("active"),e.addClass("active"),this.$surveyForm.find('input[name="is_parent"]').val(e.attr("data-value"))},showDialog:function(t,e,n){i.show({title:"",type:t,msg:e,mask:!0,exClassName:"basic-info-dialog",width:380,buttons:[{text:"确定",type:"primary",click:function(){this.remove(),n&&n()}}]})},showVMarkNotice:function(){var t=this;this.$successNotice.height(0).removeClass("hidden"),this.$successNotice.animate({marginTop:10,height:30,opacity:1},500),setTimeout(function(){t.$successNotice.animate({marginTop:0,height:0,opacity:0},500,function(){t.$successNotice.addClass("hidden")})},6e3)},validateOtherInput:function(t){var e=$.trim(t.val()),i=e.length,o=i+n.checkChineseLength(e);return o>10?(t.siblings(".ui-tooltips").removeClass("hidden"),t.addClass("input-error"),!1):(t.siblings(".ui-tooltips").addClass("hidden"),t.removeClass("input-error"),!0)},validateOther:function(t){var e=$(t.target);return this.validateOtherInput(e)},validateAllOthers:function(){var t=this,e=[];return this.$others.each(function(){var i=$(this);e.push(t.validateOtherInput(i))}),_.contains(e,!1)},othersFocus:function(t){var e=$(t.target),i=e.parent().prev("");e.siblings(".ui-tooltips").addClass("hidden"),e.removeClass("input-error"),i.hasClass("active")||i.trigger("click")},submit:function(t){t.preventDefault();var i,n=this,o={};if(i=this.validateAllOthers(),!this.$surveySubmit.hasClass("disabled")&&!i){if(this.$inputs.each(function(){var t=$(this);o[t.attr("name")]=$.trim(t.val())}),!myitoken)return n.showDialog("warning","请求提交失败，请稍后再试。"),!1;o.myitoken=myitoken;var a=JSON.stringify(o);$.ajax({url:"//myi.vip.com/api/account/survey",type:"POST",data:a,contentType:"application/json",success:function(t){e.handle302(t),200===t.code?(n.bindInputsToOldSurveyData(),n.showDialog("success","资料保存成功",function(){"1"===t.msg&&n.showVMarkNotice()})):n.showDialog("warning","资料保存失败")},error:function(){n.showDialog("warning","资料保存失败")},complete:function(){n.$surveySubmit.removeClass("disabled")}})}},reset:function(){_.isEmpty(this.oldSurveyData)?(this.$marryRadio.removeClass("active"),this.$childRadio.removeClass("active"),this.$dropdowns.smartdropdown("selected",0,!1),this.$dropdowns.find("> .text").text("请选择"),this.$chooseGroup.find("li").removeClass("active"),this.$surveyForm.find(":text").val("")):(this.bindOldSurveyDataToInputs(),this.renderMockFormElement()),"1"===this.$inputs.filter('[name="is_married"]').val()?this.$childStatus.removeClass("hidden"):this.$childStatus.addClass("hidden")}},$(function(){(new o).init()})}),seajs.use(["post","panel"],function(t){var e,i,n=t.post;e={data:{searchSizes:function(t,i){i||(i=t,t=void 0);var o="//myi.vip.com/api/size"+(t&&t.id?t.id:"");n.get(o,function(t){200==t.code?i(t.data):e.ui.displayInfoFromType("error")})},setDefault:function(t,e){e||(e=t,t=void 0);var o=["size_id="+i.checkId,"name="+i.informationListDate[i.checkId].name],a="//myi.vip.com/api/size/set_default?"+o.join("&");n.get(a,function(t){e(t)})},deleteInformation:function(t,e){if(!myitoken)return n.alert("请求提交失败，请稍后再试。"),i.button.deletes.removeClass("clicked"),!1;e||(e=t,t=void 0);var o="//myi.vip.com/api/size/delete/"+i.checkId+"?myitoken="+myitoken;n.get(o,function(t){i.button.deletes.removeClass("clicked"),200==t.code?e(t):n.alert(60001==t.code?"很抱歉，默认尺码不允许删除":"删除失败，请稍后重试！")})},addInformation:function(t,e){e||(e=t,t=void 0);var n="//myi.vip.com/api/size/create",o={name:t&&t.name?t.name:$.trim(i.inputs.name.val()),gender:i.gender,height:t&&t.height?t.height:$.trim(i.inputs.height.val()),weight:t&&t.weight?t.weight:$.trim(i.inputs.weight.val()),bust:t&&t.bust?t.bust:$.trim(i.inputs.bust.val())||"0",hip:t&&t.hip?t.hip:$.trim(i.inputs.hip.val())||"0",waist:t&&t.waist?t.waist:$.trim(i.inputs.waist.val())||"0"};$.ajax({url:n,type:"POST",contentType:"application/json",data:JSON.stringify(o),dataType:"json",success:function(t){e(t)}})},changeSize:function(t,e){e||(e=t,t=void 0);var n="//myi.vip.com/api/size/update/"+i.checkId,o={name:t&&t.name?t.name:$.trim(i.inputs.name.val()),gender:i.gender,height:t&&t.height?t.height:$.trim(i.inputs.height.val()),weight:t&&t.weight?t.weight:$.trim(i.inputs.weight.val()),bust:t&&t.bust?t.bust:$.trim(i.inputs.bust.val())||"0",hip:t&&t.hip?t.hip:$.trim(i.inputs.hip.val())||"0",waist:t&&t.waist?t.waist:$.trim(i.inputs.waist.val())||"0"};$.ajax({url:n,contentType:"application/json",type:"POST",data:JSON.stringify(o),dataType:"json",success:function(t){e(t)}})}},ev:{checkedSize:function(){i.informationList.on("click",".radio",function(){var t=$(this);i.checkId=t.attr("list-id"),t.addClass("hover").parents("tr").siblings().find(".radio").removeClass("hover")})},setDefault:function(){i.button.setDefault.on("click",function(){0==i.checkId&&n.alert("请先选择要设置的选项！"),$(this).hasClass("clicked")||(i.button.setDefault.addClass("clicked"),e.data.setDefault(e.ui.setDefault))})},deleteInformation:function(){var t=new showBox({litterTitle:'<i class="icon-wanning"></i><span>确认删除？</span>',button:'<a href="javascript:;" class="btn-queding btn-queding-delete" data-close="true">确定</a><a href="javascript:;" class="btn-quexiao ui-button secondary" data-close="true">取消</a>'});$(".show-box").on("click",".btn-queding-delete",function(){i.button.deletes.addClass("clicked"),e.data.deleteInformation(e.ui.deleteInformation)}),i.button.deletes.on("click",function(){return 0==i.checkId?(n.alert("请先选择要删除的选项！"),!1):void(i.button.deletes.hasClass("clicked")||t.show())})},addInformation:function(t){i.buttonSaveSize.removeClass("clicked"),200==t.code?(e.data.searchSizes(e.ui.displaySizeDate),i.saveSuccess.show(),$(".btn-queding-save").unbind().click(function(){"1"==t.msg&&setTimeout(e.ui.giveVPoint,500)})):n.alert(500==t.code?"信息填写有误，请核对后重新提交！":"保存失败，请稍后重试！")},showMeter:function(){for(var t=0;t<i.meterKind.length;t++)!function(t){i.inputs[i.meterKind[t]].on("focus",function(){i.focusRoom=i.meterKind[t],e.ev.sizeReturnRight()})}(t)},sizeReturnRight:function(){for(var t=i.messageNoticeBox.find('[func="'+i.focusRoom+'"]'),e=0;e<i.funcKind.length;e++)i.messageNoticeBox.find('[func="'+i.funcKind[e]+'"]').addClass("hidden");if(t.length)t.removeClass("hidden"),t.find(i.genderObj[i.gender]).removeClass("hidden").siblings().addClass("hidden");else{var n=i.messageNoticeBox.find('[func="normal"]');n.removeClass("hidden"),n.find(i.genderObj[i.gender]).removeClass("hidden").siblings().addClass("hidden")}},checkForm:function(){i.inputs.name.on("blur",function(){e.ev.checkName()}).on("focus",function(){var t=$(this);t.unbindWarning()}),i.inputs.height.on("blur",function(){e.ev.checkName(),e.ev.checkHeight()}).on("focus",function(){var t=$(this);t.unbindWarning()}),i.inputs.weight.on("blur",function(){e.ev.checkName(),e.ev.checkHeight(),e.ev.checkWeight()}).on("focus",function(){var t=$(this);t.unbindWarning()});for(var t=["bust","waist","hip"],n=0;n<t.length;n++)!function(n){var o=t[n];i.inputs[o].on("blur",function(){e.ev.checkBustDown()}).on("focus",function(){var t=$(this);t.unbindWarning()})}(n)},checkInput:function(t){var e=$.trim(t),i=/^[1-9]?[0-9]+$/g;return e?e.length>3?"tooMax":i.test(e)?0==e?"非零":!0:"正整数":null},checkName:function(){var t=i.inputs.name;return t.btrue=!1,null==e.ev.checkInput(t.val())?t.warning({text:"请填写称呼"}):(t.unbindWarning(),t.btrue=!0),t.btrue},checkHeight:function(){var t=i.inputs.height;return t.btrue=!1,null==e.ev.checkInput(t.val())?t.warning({text:"请填写身高",btrue:i.inputs.name.btrue}):"正整数"==e.ev.checkInput(t.val())?t.warning({text:"请输入正整数",btrue:i.inputs.name.btrue}):"tooMax"==e.ev.checkInput(t.val())?t.warning({text:"最大长度为3个字符",btrue:i.inputs.name.btrue}):"非零"==e.ev.checkInput(t.val())?t.warning({text:"请填写有效身高",btrue:i.inputs.name.btrue}):(t.unbindWarning(),t.btrue=!0),t.btrue},checkWeight:function(){var t=i.inputs.weight;return t.btrue=!1,null==e.ev.checkInput(t.val())?t.warning({text:"请填写体重",btrue:i.inputs.name.btrue&&i.inputs.height.btrue}):"正整数"==e.ev.checkInput(t.val())?t.warning({text:"请输入正整数",btrue:i.inputs.name.btrue&&i.inputs.height.btrue}):"tooMax"==e.ev.checkInput(t.val())?t.warning({text:"最大长度为3个字符",btrue:i.inputs.name.btrue&&i.inputs.height.btrue}):"非零"==e.ev.checkInput(t.val())?t.warning({text:"请填写有效体重",btrue:i.inputs.name.btrue&&i.inputs.height.btrue}):(t.unbindWarning(),t.btrue=!0),t.btrue},checkBustDown:function(){for(var t=["bust","waist","hip"],n=0;n<t.length;n++)!function(n){var o=t[n],a=i.inputs[o];a.unbindWarning(),a.btrue=!1;for(var s=!0,r=0;n>r;r++)0==i.inputs[t[r]].btrue&&(s=!1);null==e.ev.checkInput(a.val())||"正整数"==e.ev.checkInput(a.val())?a.warning({text:"请输入正整数",btrue:s}):"tooMax"==e.ev.checkInput(a.val())?a.warning({text:"最大长度为3个字符",btrue:s}):(a.unbindWarning(),a.btrue=!0)}(n)},addMethod:function(){!function(){$.fn.warning=function(t){function e(t,e){e.css({position:"absolute",left:t.position().left,top:-1*t.position().top-t.outerHeight()-8,marginLeft:0})}var i={btrue:!0},n=$.extend({},i,t);return this.each(function(){var t=$(this);t.addClass("error-notice");var i=$('<span class="ui-tooltips arrow-bottom-left warning"><i class="icon"></i><span></span></span>');e(t,i),n.btrue===!0&&(t.next().hasClass("warning")?(t.next().find("span").text(n.text),t.next().show()):(i.find("span").text(n.text),t.after(i)))})},$.fn.unbindWarning=function(t){return this.each(function(){var t=$(this);t.removeClass("error-notice"),t.next().hasClass("warning")&&t.next().hide()})}}(),function(){function t(t){this.opts={title:t.title||void 0,litterTitle:t.litterTitle||void 0,content:t.content||void 0,button:t.button||void 0},this.title=oTool.$content.find(".show-title").find("p"),this.litterTitle=oTool.$content.find(".litter-title"),this.content=oTool.$content.find(".content"),this.button=oTool.$content.find(".show-link")}function e(){window.oTool={},oTool.$bg=$("<div></div>").hide(),oTool.$content=$('<div class="show-box"><div class="show-box-bg"></div><div class="show-container"><div class="show-title"><p>提示</p><span class="btn-close" data-close="true">x</span></div><div class="show-content"><div class="litter-title">欢迎来到唯品会！</div><div class="content">欢迎来到唯品会！</div></div><div class="show-link"><a href="javascript:;" class="btn-queding" data-close="true">确定</a></div></div></div>').hide(),oTool.$bg.appendTo("body"),oTool.$content.appendTo("body"),oTool.$content.on("click","*",function(){var t=$(this);return 1==t.data("close")?(oTool.$content.hide(),oTool.$bg.hide(),!1):void 0})}t.prototype.show=function(){oTool.$content.css({marginTop:-1*oTool.$content.outerHeight()/2}).show(),this.opts.title?this.title.html(this.opts.title).parent().removeClass("no-show-title"):this.title.parent().addClass("no-show-title"),this.opts.litterTitle?this.litterTitle.html(this.opts.litterTitle).removeClass("hidden"):this.litterTitle.addClass("hidden"),this.opts.content?this.content.html(this.opts.content).removeClass("hidden"):this.content.addClass("hidden"),this.opts.button?this.button.html(this.opts.button).removeClass("hidden"):this.button.html('<a href="javascript:;" class="btn-queding" data-close="true">确定</a></div>'),oTool.$bg.css({position:"absolute",left:"0",top:"0",width:$("html").outerWidth(),height:$(document.body).outerHeight(),opacity:.3,background:"#000",zIndex:998}).show()},t.prototype.hide=function(){oTool.$content.hide(),oTool.$bg.hide()},e(),window.showBox=t}()},setStrLen:function(t,e){for(var t=t.toString().split(""),i=/[^\u4e00-\u9fa5]/i,n="",o=0,a=0;a<t.length;a++)o+=i.test(t[a])?.5:1,e>=o&&(n+=t[a]);var t="";return t=o>e?n+"...":n},changeSize:function(t){i.buttonSaveSize.removeClass("clicked"),200==t.code?(e.data.searchSizes(e.ui.displaySizeDate),i.saveSuccess.show(),i.changeOrAdd="add",$(".btn-queding-save").unbind().click(function(){"1"==t.msg&&setTimeout(e.ui.giveVPoint,500)})):n.alert(500==t.code?"信息填写有误，请核对后重新提交！":"保存失败，请稍后重试！")},chearInput:function(){i.informationList.addClass("hidden"),i.addInformationForm.removeClass("hidden").addClass("active"),i.genderBox.find(".radio").eq(0).trigger("click");for(var t in i.inputs)i.inputs.hasOwnProperty(t)&&i.inputs[t].val("")},initEvents:function(){e.ev.addMethod(),e.ev.checkForm(),e.data.searchSizes(e.ui.displaySizeDate),$("#tabMysize").on("click",function(){e.data.searchSizes(e.ui.displaySizeDate)}),e.ev.checkedSize(),e.ev.setDefault(),e.ev.deleteInformation(),i.goAddInformation.on("click",function(){e.ev.chearInput()}),i.buttonSaveSize.on("click",function(){if(e.ev.checkName(),e.ev.checkHeight(),e.ev.checkWeight(),!i.buttonSaveSize.hasClass("clicked")&&e.ev.checkName()&&e.ev.checkHeight()&&e.ev.checkWeight()){if(e.ev.checkBustDown(),!i.inputs.bust.btrue||!i.inputs.waist.btrue||!i.inputs.hip.btrue)return!1;i.buttonSaveSize.addClass("clicked"),"add"==i.changeOrAdd?e.data.addInformation(e.ev.addInformation):e.data.changeSize(e.ev.changeSize)}}),i.genderBox.find(".radio").on("click",function(){var t=$(this);i.gender=t.attr("gender"),t.addClass("active").siblings(".radio").removeClass("active"),e.ev.sizeReturnRight()}),e.ev.showMeter(),i.button.set.on("click",function(){if(0==i.checkId)return n.alert("请先选择要修改的内容！"),!1;i.changeOrAdd="change";var t=i.informationListDate[i.checkId];"MALE"==t.gender?i.genderBox.find(".radio").eq(0).trigger("click"):i.genderBox.find(".radio").eq(1).trigger("click"),i.informationList.addClass("hidden"),i.addInformationForm.removeClass("hidden").addClass("active");for(var e in i.inputs)i.inputs.hasOwnProperty(e)&&"/"!=t[e]&&i.inputs[e].val(t[e])}),i.saveSuccess=new showBox({litterTitle:'<i class="icon-success"></i><span>资料保存成功</span>',button:'<a href="javascript:;" class="btn-queding btn-queding-save" data-close="true">确定</a>'}),$("#btn_refresh").on("click",function(){e.data.searchSizes(e.ui.displaySizeDate)})}},ui:{displaySizeDate:function(t){if(e.ui.displayInfoFromType("success"),i.checkId=0,t.length){i.addInformationForm.addClass("hidden"),i.informationList.removeClass("hidden");for(var n="",o=0;o<t.length;o++){i.informationListDate[t[o].id]=t[o],"true"==t[o].is_default&&(i.checkId=t[o].id);var a=o==t.length-1?"lastlist":"";n+="<tr class="+a+'><td class="ta-l" width="25%" height="40"><span list-id="'+t[o].id+'" class="radio '+("true"==t[o].is_default?"hover":"")+'"></span><span title="'+t[o].name+'">'+e.ev.setStrLen(t[o].name,5)+'</span></td><td width="15%">'+t[o].height+'</td><td width="15%">'+t[o].weight+'</td><td width="15%">'+t[o].bust+'</td><td width="15%">'+t[o].waist+'</td><td width="15%">'+t[o].hip+"</td></tr>"}i.informationList.find(".information-bg").find("tbody").html(n),i.goAddInformation[t.length>=10?"addClass":"removeClass"]("hidden")}else e.ev.chearInput()},setDefault:function(t){i.button.setDefault.removeClass("clicked"),200==t.code?(n.confirm("设置成功！"),e.data.searchSizes(e.ui.displaySizeDate)):n.alert("设置失败，请稍后再试！")},giveVPoint:function(){var t=$("#success-notice");t.removeClass("hidden");var e=30;t.height(0).stop().animate({marginTop:10,height:e,opacity:1}),function(){function e(i){i--,window.timer=setTimeout(function(){clearTimeout(window.timer),i>0?e(i):t.animate({height:0,opacity:0,marginTop:0},function(){t.addClass("hidden")})},1e3)}var i=6;e(i)}()},deleteInformation:function(t){delete i.informationListDate[i.checkId],e.data.searchSizes(e.ui.displaySizeDate)},displayInfoFromType:function(t,e){var i={loading:1,success:1,error:1,"null":1,nullExchange:1};t=i[t]?t:"loading",e=e||$("#accountContent");for(var n in i)"prototype"!=n&&e.find("[func='"+n+"']")[(t==n?"remove":"add")+"Class"]("hidden")}},config:function(){i={warnStyle:{backgroundColor:"#ffeded",border:"1px solid #fca1a5"},meterKind:["name","height","weight","bust","waist","hip"],funcKind:["normal","bust","waist","hip"],genderObj:{MALE:".male",FEMALE:".female"},informationList:$("#information-list"),goAddInformation:$("#go-add-information"),addInformationForm:$("#add-information-form"),informationInfo:$("#information-info"),messageNoticeBox:$("#information-message"),buttonSaveSize:$("#save-size"),changeOrAdd:"add",informationListDate:{},genderBox:$("#gender"),gender:"MALE",focusRoom:"normal",checkId:0,button:{deletes:$("#delete-information"),set:$("#set-information"),setDefault:$("#set-default")},inputs:{name:$("#nickName"),height:$("#userHeight"),weight:$("#userWeight"),bust:$("#userChest"),waist:$("#userWaistline"),hip:$("#userHips")}},n.error(function(t){var e;302==t.code&&(e=encodeURIComponent(window.location.href),window.location.href=t.data.replace(/src=.*/,"")+e)})}},$(document).ready(function(){e.config(),e.ev.initEvents()})});